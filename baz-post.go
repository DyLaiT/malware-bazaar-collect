package main

import ("net/http"
		"net/url"
		"fmt"
		"io/ioutil"
		"os"
		"encoding/json"
	   )

func recent_malware(selector string) []byte {  
	resp, err := http.PostForm("https://mb-api.abuse.ch/api/v1/",  
							   url.Values{"query":{"get_recent"}, "selector":{selector}})  
	if err != nil {  
		fmt.Println(err)  
	}  

	defer resp.Body.Close()  
	body, err := ioutil.ReadAll(resp.Body)  
	if err != nil {  
	// handle error  
	}  

	//fmt.Println(string(body))  
	return body
} 

func search_hash(file_hash string) []byte {  
	resp, err := http.PostForm("https://mb-api.abuse.ch/api/v1/",  
							   url.Values{"query":{"get_info"}, "hash":{file_hash}})  
	if err != nil {  
		fmt.Println(err)  
	}  

	defer resp.Body.Close()  
	body, err := ioutil.ReadAll(resp.Body)  
	if err != nil {  
	// handle error  
	}  

	//fmt.Println(string(body))  
	return body
} 
func download_malware(file_hash string) {  
	resp, err := http.PostForm("https://mb-api.abuse.ch/api/v1/",  
							   url.Values{"query":{"get_file"}, "sha256_hash":{file_hash}})  
	if err != nil {  
		fmt.Println(err)  
	}  
	
	defer resp.Body.Close()  
	body, err := ioutil.ReadAll(resp.Body)  
	if err != nil {  
		fmt.Println(err)  
		return
	}  
	
	file, err := os.Open(file_hash)
	if err != nil{
		fmt.Println(err)
		return
	}
	
	stat, err := file.Stat()
	if err != nil{
		fmt.Println(err)
		return
	}
	fmt.Println(stat)
	
	
	fmt.Println(string(body))  
} 
func json2interface(input_json []byte) []interface{}{
	var jsonObj map[string]interface{}
	json.Unmarshal(input_json, &jsonObj)
	//jsonObj["data"].([]interface{})[list_index].(map[string]interface{})["you_want_key"]
	return jsonObj["data"].([]interface{})
}
func main(){
	//search_hash("094fd325049b8a9cf6d3e5ef2a6d4cc6a567d7d49c35f8bb8dd9e3c6acf3d78d")
	//recent_malware("time")
	//download_malware("a5072c297cd80acffd9da5124dd8ff867da5abd6effc2dabea853fd93a8cccdc")
	recent_list :=json2interface(recent_malware("time"))
	for _, v := range recent_list{
		fmt.Println(v.(map[string]interface{})["md5_hash"])
	}
	
}
